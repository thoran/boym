#!/usr/bin/env ruby
# payslip

# 20150710, 11
# 0.0.1

require 'SimpleCSV.rbd/SimpleCSV'

require_relative '../lib/employee'

tax_table_file = File.expand_path(File.join('..', '..', 'data', 'tax_table.csv'), __FILE__)
tax_table = TaxTable.load(tax_table_file)

input_csv_file = File.expand_path(File.join('..', '..', 'spec', 'data', 'input.csv'), __FILE__)
input_csv = SimpleCSV.open(input_csv_file, headers: true)

output_csv_file = File.expand_path(File.join('..', '..', 'data', 'output.csv'), __FILE__)
output_csv = CSVFile.new(output_csv_file, headers: true, mode: 'w', quote: :none)
output_csv.columns = [:name, :pay_period, :gross_income, :income_tax, :net_income, :super]

input_csv.each do |employee_pay_details|
  output_csv.rows << Employee.new(employee_pay_details).to_h
end

output_csv.write
